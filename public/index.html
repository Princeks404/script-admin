<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Script Manager Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; padding: 20px 0; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
        }
        .stat-number { font-size: 2em; font-weight: bold; color: #4CAF50; }
        .stat-label { font-size: 0.9em; color: rgba(255,255,255,0.8); }
        .upload-form {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        .form-group textarea {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }
        .script-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        .script-item {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.15);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .script-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .script-title { font-size: 1.2em; margin-bottom: 10px; font-weight: 600; }
        .script-url {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            word-break: break-all;
        }
        .script-actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .edit-form {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            display: none;
        }
        .raw-domain { 
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.6);
        }
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Script Manager Admin</h1>
            <p>Powered by Upstash Redis ‚Ä¢ Upload and manage your Roblox scripts</p>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="script-count">0</div>
                <div class="stat-label">Total Scripts</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="storage-used">0KB</div>
                <div class="stat-label">Storage Used</div>
            </div>
        </div>

        <div class="raw-domain">
            <strong>üîó Raw Script Domain:</strong><br>
            Scripts are accessible at: <code id="raw-domain-url">https://your-raw-domain.vercel.app/script-name</code>
        </div>

        <div class="upload-form">
            <h3 style="margin-bottom: 20px;">üìù Upload New Script</h3>
            <form id="upload-form">
                <div class="form-group">
                    <label for="script-name">Custom Name:</label>
                    <input type="text" id="script-name" placeholder="my-awesome-script" required>
                </div>
                <div class="form-group">
                    <label for="script-content">Script Content:</label>
                    <textarea id="script-content" placeholder="-- Your Roblox script here&#10;print('Hello World!')" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="upload-btn">Upload Script</button>
            </form>
        </div>

        <div>
            <h3 style="margin-bottom: 20px;">üìã Uploaded Scripts</h3>
            <div id="script-list" class="script-list">
                <div class="loading">Loading scripts from Upstash Redis...</div>
            </div>
        </div>
    </div>

    <script>
        const RAW_DOMAIN = 'https://princex-script-raw.vercel.app/'; // Update this!
        let scripts = {};

        document.addEventListener('DOMContentLoaded', function() {
            loadScripts();
            updateRawDomainUrl();
        });

        function updateRawDomainUrl() {
            document.getElementById('raw-domain-url').textContent = RAW_DOMAIN + '/script-name';
        }

        document.getElementById('upload-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('script-name').value.trim();
            const content = document.getElementById('script-content').value.trim();
            const uploadBtn = document.getElementById('upload-btn');
            
            if (!name || !content) {
                showError('Please fill in both name and content fields.');
                return;
            }

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';

            try {
                const response = await fetch('/api/scripts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, content }),
                });

                if (response.ok) {
                    await loadScripts();
                    document.getElementById('script-name').value = '';
                    document.getElementById('script-content').value = '';
                    showSuccess('Script uploaded successfully to Upstash Redis!');
                } else {
                    const error = await response.json();
                    showError('Error: ' + error.error);
                }
            } catch (error) {
                console.error('Upload error:', error);
                showError('Failed to upload script to Upstash');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Upload Script';
            }
        });

        async function loadScripts() {
            try {
                const response = await fetch('/api/scripts');
                if (!response.ok) throw new Error('Failed to fetch');
                
                scripts = await response.json();
                renderScripts();
                updateStats();
            } catch (error) {
                console.error('Failed to load scripts:', error);
                document.getElementById('script-list').innerHTML = `
                    <div class="error">Failed to load scripts from Upstash Redis</div>
                `;
            }
        }

        function renderScripts() {
            const scriptList = document.getElementById('script-list');
            const scriptCount = Object.keys(scripts).length;
            
            if (scriptCount === 0) {
                scriptList.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; color: rgba(255,255,255,0.6); padding: 40px;">
                        No scripts in Upstash Redis yet. Upload your first script above!
                    </div>
                `;
                return;
            }

            scriptList.innerHTML = '';
            
            Object.entries(scripts).forEach(([id, scriptData]) => {
                const script = typeof scriptData === 'string' ? JSON.parse(scriptData) : scriptData;
                const scriptItem = document.createElement('div');
                scriptItem.className = 'script-item';
                scriptItem.innerHTML = `
                    <div class="script-title">${escapeHtml(script.originalName || script.name)}</div>
                    <div class="script-url">${RAW_DOMAIN}/${escapeHtml(script.name)}</div>
                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.7); margin: 8px 0;">
                        Size: ${formatBytes(script.content.length)}<br>
                        Created: ${new Date(script.created).toLocaleString()}<br>
                        Updated: ${new Date(script.updated).toLocaleString()}
                    </div>
                    <div class="script-actions">
                        <button onclick="copyUrl('${escapeHtml(script.name)}')" class="btn btn-secondary">Copy URL</button>
                        <button onclick="editScript('${id}')" class="btn btn-secondary">Edit</button>
                        <button onclick="deleteScript('${id}')" class="btn btn-danger">Delete</button>
                    </div>
                    <div id="edit-${id}" class="edit-form">
                        <textarea id="edit-content-${id}" style="width: 100%; min-height: 150px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 10px; color: white; font-family: 'Courier New', monospace;">${escapeHtml(script.content)}</textarea>
                        <div style="margin-top: 10px;">
                            <button onclick="saveEdit('${id}')" class="btn btn-primary">Save Changes</button>
                            <button onclick="cancelEdit('${id}')" class="btn btn-secondary">Cancel</button>
                        </div>
                    </div>
                `;
                scriptList.appendChild(scriptItem);
            });
        }

        function updateStats() {
            const scriptCount = Object.keys(scripts).length;
            const totalSize = Object.values(scripts).reduce((acc, scriptData) => {
                const script = typeof scriptData === 'string' ? JSON.parse(scriptData) : scriptData;
                return acc + script.content.length;
            }, 0);

            document.getElementById('script-count').textContent = scriptCount;
            document.getElementById('storage-used').textContent = formatBytes(totalSize);
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + sizes[i];
        }

        function copyUrl(name) {
            const url = `${RAW_DOMAIN}/${name}`;
            navigator.clipboard.writeText(url).then(() => {
                showSuccess('Executor URL copied to clipboard!');
            }).catch(() => {
                prompt('Copy this executor URL:', url);
            });
        }

        function editScript(id) {
            document.getElementById(`edit-${id}`).style.display = 'block';
        }

        function cancelEdit(id) {
            document.getElementById(`edit-${id}`).style.display = 'none';
        }

        async function saveEdit(id) {
            const content = document.getElementById(`edit-content-${id}`).value.trim();
            if (!content) return;
            
            try {
                const response = await fetch('/api/scripts', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, content }),
                });

                if (response.ok) {
                    await loadScripts();
                    showSuccess('Script updated in Upstash Redis!');
                } else {
                    const error = await response.json();
                    showError('Update failed: ' + error.error);
                }
            } catch (error) {
                console.error('Update error:', error);
                showError('Failed to update script');
            }
        }

        async function deleteScript(id) {
            if (!confirm('Delete this script from Upstash Redis?')) return;
            
            try {
                const response = await fetch('/api/scripts', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id }),
                });

                if (response.ok) {
                    await loadScripts();
                    showSuccess('Script deleted from Upstash Redis!');
                } else {
                    const error = await response.json();
                    showError('Delete failed: ' + error.error);
                }
            } catch (error) {
                console.error('Delete error:', error);
                showError('Failed to delete script');
            }
        }

        function showSuccess(message) {
            const existing = document.querySelector('.success-message');
            if (existing) existing.remove();
            
            const div = document.createElement('div');
            div.className = 'success-message';
            div.style.cssText = 'position:fixed;top:20px;right:20px;background:rgba(76,175,80,0.9);color:white;padding:15px;border-radius:10px;z-index:1000;backdrop-filter:blur(10px);';
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 3000);
        }

        function showError(message) {
            const existing = document.querySelector('.error-message');
            if (existing) existing.remove();
            
            const div = document.createElement('div');
            div.className = 'error-message';
            div.style.cssText = 'position:fixed;top:20px;right:20px;background:rgba(244,67,54,0.9);color:white;padding:15px;border-radius:10px;z-index:1000;backdrop-filter:blur(10px);';
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 5000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
